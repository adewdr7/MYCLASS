<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stellar Academy - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="app.js"></script>
</head>
<body class="min-h-screen bg-[#050505] text-slate-100 font-sans">
  <nav class="fixed top-4 left-4 right-4 z-50 p-4 rounded-3xl bg-white/5 border border-white/10 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-gradient-to-tr from-cyan-500 to-purple-500 rounded-2xl flex items-center justify-center shadow-lg">
        <span class="text-white font-bold">S</span>
      </div>
      <div>
        <h1 class="text-sm font-black tracking-tighter italic">STELLAR</h1>
        <p class="text-xs text-slate-400">Active System</p>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <div id="userBadge" class="flex items-center gap-2 p-1 pr-3 rounded-2xl bg-white/5 border border-white/10">
        <div id="avatar" class="w-8 h-8 rounded-xl bg-slate-700 flex items-center justify-center text-xs font-bold"></div>
        <span id="displayName" class="text-sm font-medium"></span>
        <button id="logoutBtn" class="ml-4 text-red-400 text-sm">Keluar</button>
      </div>
    </div>
  </nav>

  <main class="pt-28 px-6 pb-20 max-w-5xl mx-auto">
    <header class="mb-10 text-center sm:text-left">
      <h2 class="text-3xl sm:text-4xl font-black mb-3 italic tracking-tight">
        Selamat Datang, <span id="heroName" class="text-cyan-400 font-bold"></span>
      </h2>
      <p class="text-slate-400 text-sm max-w-md">Dashboard Anda. Role-based content akan tampil sesuai jabatan.</p>
    </header>

    <section id="adminSection" class="hidden mb-10 p-6 rounded-[2rem] bg-white/5 border border-white/10">
      <h3 class="font-bold text-xl">Commander Terminal (Admin)</h3>
      <p class="text-sm text-slate-400">Kontrol untuk admin.</p>
    </section>

    <section id="studentSection" class="mb-10 p-6 rounded-[2rem] bg-white/5 border border-white/10">
      <h3 class="font-bold text-xl">Astronaut Dashboard (Murid)</h3>
      <p class="text-sm text-slate-400">Konten untuk murid.</p>
    </section>

    <div class="p-6 rounded-2xl bg-white/5 border border-white/10">
      <p class="text-sm">Status nama yang dipilih: <span id="chosenName" class="font-bold"></span></p>
      <p class="text-xs text-slate-400">Jika Anda keluar, nama akan tersedia kembali untuk dipilih.</p>
    </div>
  </main>

  <script type="module">
    import { logout, subscribeNames } from './app.js';

    const userName = localStorage.getItem('userName');
    const userRole = localStorage.getItem('userRole');
    const userUid = localStorage.getItem('userUid');

    if (!userName) {
      window.location.href = 'index.html';
    }

    document.getElementById('displayName').textContent = userName || 'Guest';
    document.getElementById('heroName').textContent = userName || 'Guest';
    document.getElementById('avatar').textContent = (userName || 'G').substring(0,2);
    document.getElementById('chosenName').textContent = userName || '-';

    if (userRole === 'admin') {
      document.getElementById('adminSection').classList.remove('hidden');
      document.getElementById('studentSection').classList.add('hidden');
    } else {
      document.getElementById('adminSection').classList.add('hidden');
      document.getElementById('studentSection').classList.remove('hidden');
    }

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      const ok = confirm('Apakah Anda yakin ingin keluar?');
      if (ok) {
        await logout();
      }
    });

    // Optional realtime: show if chosen name is still held
    subscribeNames((data) => {
      const entry = data && data[userName];
      if (!entry || !entry.claimedBy) {
        // someone (maybe after disconnect) released the name unexpectedly
        document.getElementById('chosenName').textContent = userName + ' (LEPAS)';
      } else if (entry.claimedBy === userUid) {
        document.getElementById('chosenName').textContent = userName + ' (TERKLAIM OLEH ANDA)';
      } else {
        document.getElementById('chosenName').textContent = userName + ' (DIKLAIM OLEH ORANG LAIN)';
      }
    });
  </script>
</body>
</html>
